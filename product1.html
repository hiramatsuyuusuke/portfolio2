<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <link rel="stylesheet" href="base.css">   
    <!--
    <link rel="stylesheet" media="screen and (min-width:481px)" href="base.css">
    <link rel="stylesheet" media="screen and (max-width:480px)" href="base_sp.css">
    -->
    <title>prtfolio</title>

</head>



<body>

<div id="pagebody">
    
    <!-- ヘッダー -->
    <div id="header">
        <h1><img src="images/logo.png" alt="portfolio"></h1>
    </div>

    <div id="title2_id">
        <h2>PyODEの物理演算+深層学習(ResNet18)</h2>
        <h2>: ロボットビジョン1 </h2>
        <h2>「転がる箱ロボットの衝突回避」</h2>  
    </div>
    <div id="info_id2">
        <hr>
        <h3 id="info0001">「転がる箱ロボットの衝突回避」の実行例</h3>
<pre style = "font-size: 15px">
    
箱ロボットの視界から障害物に衝突するかどうかを判定して、衝突しない方に転がって進みます。
衝突するかどうかの判定は、学習済みの深層学習モデル(ResNet18)が行います。
ResNet18の学習は、左側の動画の3D空間から作成した学習用画像を使って行いました。
左側の動画は、学習用画像と同じ環境で衝突回避を行っています。
右側の動画は、今回の学習済みモデル(ResNet18)にとっては、未知の環境ですが、上手く衝突回避することが出来ました。
</pre>
        <video src="videos/box_robot_vision2.mp4" controls class="video_index2"></video>
        <video src="videos/box_robot_vision1.mp4" controls class="video_index2"></video>
        <img src="images/product1_1.jpg" alt="resnet18" >
<pre>


</pre>
        <hr>
        <h3 id="info0002">「転がる箱ロボットの衝突回避」の実装</h3>
<pre style = "font-size: 15px">
    
ODE-0.16.4付属のtutorial3.pyと同じ内容のbox_robo_vision1.pyを作成して、2つを比較しながらbox_robo_vision1.pyを変更して
いくやり方で「転がる箱ロボットの衝突回避」を実装していきます。

<h2>まずはimportの追加</h2>
box_robo_vision1.pyのソースコードに下記のコードを追加します。
追加する場所は、tutorial3.pyの17行目に対応する行です。16行目の「<code style="color:rgb(89, 89, 89)">import ode</code>」の次の行です。
インポートには、前もって、PIL（Pillow）、PyTorch、Torchvisionのインストールが必要です。

<pre class="andromeeda" style="background-color:#23262E;color:#D5CED9;width:400px;padding:20px" ><code><div class="line"><span style="color:#C74DED">from</span><span style="color:#F39C12"> PIL</span><span style="color:#C74DED"> import</span><span style="color:#D5CED9"> Image</span></div><div class="line"><span style="color:#C74DED">from</span><span style="color:#F39C12"> PIL</span><span style="color:#C74DED"> import</span><span style="color:#D5CED9"> ImageOps</span></div><div class="line"><span style="color:#C74DED">import</span><span style="color:#D5CED9"> torch</span></div><div class="line"><span style="color:#C74DED">from</span><span style="color:#D5CED9"> torch </span><span style="color:#C74DED">import</span><span style="color:#D5CED9"> nn</span></div><div class="line"><span style="color:#C74DED">import</span><span style="color:#D5CED9"> torchvision.transforms </span><span style="color:#C74DED">as</span><span style="color:#D5CED9"> transforms</span></div><div class="line"><span style="color:#C74DED">import</span><span style="color:#D5CED9"> torchvision.models </span><span style="color:#C74DED">as</span><span style="color:#D5CED9"> models</span></div></code></pre>

<h2>prepare_GL()関数を変更</h2>
box_robo_vision1.pyのソースコードを下記のように変更します。
変更する場所は、tutorial3.pyの28～60行目の「<code style="color:rgb(89, 89, 89)">prepare_GL()</code>」関数に対応する部分です。

<pre class="andromeeda" style="background-color:#23262E;color:#D5CED9;width:600px;padding:20px"><code><div class="line"><span style="color:#C74DED">def</span><span style="color:#FFE66D"> prepare_GL</span><span style="color:#D5CED9">():</span></div><div class="line"><span style="color:#96E072">    """Prepare drawing.</span></div><div class="line"><span style="color:#96E072">    """</span></div><div class="line"><span style="color:#A0A1A7CC">    # Viewport</span></div><div class="line"><span style="color:#FFE66D">    glViewport</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">0</span><span style="color:#D5CED9">,</span><span style="color:#F39C12">0</span><span style="color:#D5CED9">,</span><span style="color:#F39C12">320</span><span style="color:#D5CED9">,</span><span style="color:#F39C12">320</span><span style="color:#D5CED9">) </span><span style="color:#A0A1A7CC">#ビューポートの大きさを320×320にする</span></div><div class="line">
</div><div class="line"><span style="color:#A0A1A7CC">    # Initialize</span></div><div class="line"><span style="color:#FFE66D">    glClearColor</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">0</span><span style="color:#D5CED9">,</span><span style="color:#F39C12">0</span><span style="color:#D5CED9">,</span><span style="color:#F39C12">0</span><span style="color:#D5CED9">,</span><span style="color:#F39C12">0</span><span style="color:#D5CED9">)   </span><span style="color:#A0A1A7CC">#背景を黒にする</span></div><div class="line"><span style="color:#FFE66D">    glClear</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_COLOR_BUFFER_BIT</span><span style="color:#EE5D43"> |</span><span style="color:#F39C12"> GL_DEPTH_BUFFER_BIT</span><span style="color:#D5CED9">);</span></div><div class="line"><span style="color:#FFE66D">    glEnable</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_DEPTH_TEST</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#FFE66D">    glDisable</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_LIGHTING</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#FFE66D">    glEnable</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_LIGHTING</span><span style="color:#D5CED9">)  </span></div><div class="line"><span style="color:#FFE66D">    glEnable</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_NORMALIZE</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#FFE66D">    glShadeModel</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_FLAT</span><span style="color:#D5CED9">)</span></div><div class="line">
</div><div class="line"><span style="color:#A0A1A7CC">    # Projection</span></div><div class="line"><span style="color:#FFE66D">    glMatrixMode</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_PROJECTION</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#FFE66D">    glLoadIdentity</span><span style="color:#D5CED9">()</span></div><div class="line"><span style="color:#FFE66D">    gluPerspective</span><span style="color:#D5CED9"> (</span><span style="color:#F39C12">45</span><span style="color:#D5CED9">,</span><span style="color:#F39C12">1.3333</span><span style="color:#D5CED9">,</span><span style="color:#F39C12">0.2</span><span style="color:#D5CED9">,</span><span style="color:#F39C12">20</span><span style="color:#D5CED9">)</span></div><div class="line">
</div><div class="line"><span style="color:#A0A1A7CC">    # Initialize ModelView matrix</span></div><div class="line"><span style="color:#FFE66D">    glMatrixMode</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_MODELVIEW</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#FFE66D">    glLoadIdentity</span><span style="color:#D5CED9">()</span></div><div class="line">
</div><div class="line"><span style="color:#A0A1A7CC">    # Light source</span></div><div class="line"><span style="color:#FFE66D">    glLightfv</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_LIGHT0</span><span style="color:#D5CED9">,</span><span style="color:#F39C12">GL_POSITION</span><span style="color:#D5CED9">,[ </span><span style="color:#F39C12">0.3</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.3</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0</span><span style="color:#D5CED9">])  </span><span style="color:#A0A1A7CC">#照明の位置を変更</span></div><div class="line"><span style="color:#FFE66D">    glLightfv</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_LIGHT0</span><span style="color:#D5CED9">,</span><span style="color:#F39C12">GL_DIFFUSE</span><span style="color:#D5CED9">,[</span><span style="color:#F39C12">1</span><span style="color:#D5CED9">,</span><span style="color:#F39C12">1</span><span style="color:#D5CED9">,</span><span style="color:#F39C12">1</span><span style="color:#D5CED9">,</span><span style="color:#F39C12">1</span><span style="color:#D5CED9">])</span></div><div class="line"><span style="color:#FFE66D">    glLightfv</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_LIGHT0</span><span style="color:#D5CED9">,</span><span style="color:#F39C12">GL_SPECULAR</span><span style="color:#D5CED9">,[</span><span style="color:#F39C12">1</span><span style="color:#D5CED9">,</span><span style="color:#F39C12">1</span><span style="color:#D5CED9">,</span><span style="color:#F39C12">1</span><span style="color:#D5CED9">,</span><span style="color:#F39C12">1</span><span style="color:#D5CED9">])</span></div><div class="line"><span style="color:#FFE66D">    glLightfv</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_LIGHT0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">GL_AMBIENT</span><span style="color:#D5CED9">, [</span><span style="color:#F39C12">0.5</span><span style="color:#D5CED9">,</span><span style="color:#F39C12">0.5</span><span style="color:#D5CED9">,</span><span style="color:#F39C12">0.5</span><span style="color:#D5CED9">,</span><span style="color:#F39C12">0.5</span><span style="color:#D5CED9">]) </span><span style="color:#A0A1A7CC">#環境光の設定</span></div><div class="line"><span style="color:#FFE66D">    glEnable</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_LIGHT0</span><span style="color:#D5CED9">)</span></div><div class="line">
</div><div class="line"><span style="color:#A0A1A7CC">    # View transformation</span></div><div class="line"><span style="color:#A0A1A7CC">    #gluLookAt (2.4, 3.6, 4.8, 0.5, 0.5, 0, 0, 1, 0)    #視点変換をコメントアウト</span></div></code></pre>

<h2>drop_object()関数を変更</h2>
box_robo_vision1.pyのソースコードを下記のように変更します。
変更する場所は、tutorial3.pyの103～117行目の「<code style="color:rgb(89, 89, 89)">drop_object()</code>」関数に対応する部分です。

<pre class="andromeeda" style="background-color:#23262E;color:#D5CED9;width:500px;padding:20px"><code><div class="line"><span style="color:#C74DED">def</span><span style="color:#FFE66D"> drop_object</span><span style="color:#D5CED9">( </span><span style="color:#00E8C6">lx</span><span style="color:#D5CED9">, </span><span style="color:#00E8C6">ly</span><span style="color:#D5CED9">, </span><span style="color:#00E8C6">lz</span><span style="color:#D5CED9">, </span><span style="color:#00E8C6">px</span><span style="color:#D5CED9">, </span><span style="color:#00E8C6">py</span><span style="color:#D5CED9">, </span><span style="color:#00E8C6">pz</span><span style="color:#D5CED9">):</span></div><div class="line"><span style="color:#96E072">    """Drop an object into the scene."""</span></div><div class="line">
</div><div class="line"><span style="color:#C74DED">    global</span><span style="color:#D5CED9"> bodies, geoms, objcount</span></div><div class="line">
</div><div class="line"><span style="color:#D5CED9">    body, geom </span><span style="color:#EE5D43">=</span><span style="color:#FFE66D"> create_box</span><span style="color:#D5CED9">(world, space, </span><span style="color:#F39C12">10</span><span style="color:#D5CED9">, lx, ly, lz)</span></div><div class="line"><span style="color:#D5CED9">    body.</span><span style="color:#FFE66D">setPosition</span><span style="color:#D5CED9">( (px, py, pz) )</span></div><div class="line"><span style="color:#D5CED9">    theta </span><span style="color:#EE5D43">=</span><span style="color:#F39C12"> 0</span></div><div class="line"><span style="color:#D5CED9">    ct </span><span style="color:#EE5D43">=</span><span style="color:#FFE66D"> cos</span><span style="color:#D5CED9"> (theta)</span></div><div class="line"><span style="color:#D5CED9">    st </span><span style="color:#EE5D43">=</span><span style="color:#FFE66D"> sin</span><span style="color:#D5CED9"> (theta)</span></div><div class="line"><span style="color:#D5CED9">    body.</span><span style="color:#FFE66D">setRotation</span><span style="color:#D5CED9">([ct, </span><span style="color:#F39C12">0</span><span style="color:#D5CED9">., </span><span style="color:#EE5D43">-</span><span style="color:#D5CED9">st, </span><span style="color:#F39C12">0</span><span style="color:#D5CED9">., </span><span style="color:#F39C12">1</span><span style="color:#D5CED9">., </span><span style="color:#F39C12">0</span><span style="color:#D5CED9">., st, </span><span style="color:#F39C12">0</span><span style="color:#D5CED9">., ct])</span></div><div class="line"><span style="color:#D5CED9">    bodies.</span><span style="color:#FFE66D">append</span><span style="color:#D5CED9">(body)</span></div><div class="line"><span style="color:#D5CED9">    geoms.</span><span style="color:#FFE66D">append</span><span style="color:#D5CED9">(geom)</span></div><div class="line"><span style="color:#D5CED9">    objcount </span><span style="color:#EE5D43">+=</span><span style="color:#F39C12"> 1</span></div></code></pre>

<h2>draw1()、draw2()、draw3()、display_image_recognition()、capture2()、
load_texture(*)、draw_tex_polygon()関数を追加</h2>
box_robo_vision1.pyのソースコードに下記のコードを追加します。
追加する場所は、tutorial3.pyの172行目に対応する行です。177行目の「<code style="color:rgb(89, 89, 89)">glutInit ([])</code>」の手前です。

<pre class="andromeeda" style="background-color:#23262E;color:#D5CED9;width:750px;padding:20px"><code><div class="line">
</div><div class="line"><span style="color:#A0A1A7CC">#最初の一回だけウィンドウに描画</span></div><div class="line"><span style="color:#C74DED">def</span><span style="color:#FFE66D"> draw1</span><span style="color:#D5CED9">():</span></div><div class="line"><span style="color:#FFE66D">    glutSetWindow</span><span style="color:#D5CED9">(winnum)</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glViewport</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">0</span><span style="color:#D5CED9">,</span><span style="color:#F39C12">0</span><span style="color:#D5CED9">,</span><span style="color:#F39C12">680</span><span style="color:#D5CED9">,</span><span style="color:#F39C12">450</span><span style="color:#D5CED9">) </span></div><div class="line"><span style="color:#FFE66D">    glClearColor</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">0.2</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.2</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.2</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.0</span><span style="color:#D5CED9">)   </span></div><div class="line"><span style="color:#FFE66D">    glClear</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_COLOR_BUFFER_BIT</span><span style="color:#EE5D43"> |</span><span style="color:#F39C12"> GL_DEPTH_BUFFER_BIT</span><span style="color:#D5CED9">)</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glRasterPos2f</span><span style="color:#D5CED9">(</span><span style="color:#EE5D43">-</span><span style="color:#F39C12">0.95</span><span style="color:#D5CED9">, </span><span style="color:#EE5D43">-</span><span style="color:#F39C12">0.6</span><span style="color:#D5CED9">)  </span><span style="color:#A0A1A7CC"># 描画位置を指定</span></div><div class="line"><span style="color:#D5CED9">    text </span><span style="color:#EE5D43">=</span><span style="color:#96E072"> "The view overlooking the room."</span></div><div class="line"><span style="color:#C74DED">    for</span><span style="color:#D5CED9"> char </span><span style="color:#C74DED">in</span><span style="color:#D5CED9"> text:</span></div><div class="line"><span style="color:#FFE66D">        glutBitmapCharacter</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GLUT_BITMAP_HELVETICA_18</span><span style="color:#D5CED9">, </span><span style="color:#FFE66D">ord</span><span style="color:#D5CED9">(char))  </span><span style="color:#A0A1A7CC"># 文字を描画   </span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glRasterPos2f</span><span style="color:#D5CED9">(</span><span style="color:#EE5D43">-</span><span style="color:#F39C12">0.95</span><span style="color:#D5CED9">, </span><span style="color:#EE5D43">-</span><span style="color:#F39C12">0.78</span><span style="color:#D5CED9">)  </span><span style="color:#A0A1A7CC"># 描画位置を指定</span></div><div class="line"><span style="color:#D5CED9">    text </span><span style="color:#EE5D43">=</span><span style="color:#96E072"> "The obstacles are recognized using "</span></div><div class="line"><span style="color:#C74DED">    for</span><span style="color:#D5CED9"> char </span><span style="color:#C74DED">in</span><span style="color:#D5CED9"> text:</span></div><div class="line"><span style="color:#FFE66D">        glutBitmapCharacter</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GLUT_BITMAP_HELVETICA_18</span><span style="color:#D5CED9">, </span><span style="color:#FFE66D">ord</span><span style="color:#D5CED9">(char))  </span><span style="color:#A0A1A7CC"># 文字を描画   </span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glRasterPos2f</span><span style="color:#D5CED9">(</span><span style="color:#EE5D43">-</span><span style="color:#F39C12">0.95</span><span style="color:#D5CED9">, </span><span style="color:#EE5D43">-</span><span style="color:#F39C12">0.89</span><span style="color:#D5CED9">)  </span><span style="color:#A0A1A7CC"># 描画位置を指定</span></div><div class="line"><span style="color:#D5CED9">    text </span><span style="color:#EE5D43">=</span><span style="color:#96E072"> "the view from the green box robot."</span></div><div class="line"><span style="color:#C74DED">    for</span><span style="color:#D5CED9"> char </span><span style="color:#C74DED">in</span><span style="color:#D5CED9"> text:</span></div><div class="line"><span style="color:#FFE66D">        glutBitmapCharacter</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GLUT_BITMAP_HELVETICA_18</span><span style="color:#D5CED9">, </span><span style="color:#FFE66D">ord</span><span style="color:#D5CED9">(char))  </span><span style="color:#A0A1A7CC"># 文字を描画   </span></div><div class="line">
</div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glRasterPos2f</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">0.05</span><span style="color:#D5CED9">, </span><span style="color:#EE5D43">-</span><span style="color:#F39C12">0.6</span><span style="color:#D5CED9">)  </span><span style="color:#A0A1A7CC"># 描画位置を指定</span></div><div class="line"><span style="color:#D5CED9">    text </span><span style="color:#EE5D43">=</span><span style="color:#96E072"> "The view from the green box robot."</span></div><div class="line"><span style="color:#C74DED">    for</span><span style="color:#D5CED9"> char </span><span style="color:#C74DED">in</span><span style="color:#D5CED9"> text:</span></div><div class="line"><span style="color:#FFE66D">        glutBitmapCharacter</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GLUT_BITMAP_HELVETICA_18</span><span style="color:#D5CED9">, </span><span style="color:#FFE66D">ord</span><span style="color:#D5CED9">(char))  </span><span style="color:#A0A1A7CC"># 文字を描画   </span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glRasterPos2f</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">0.05</span><span style="color:#D5CED9">, </span><span style="color:#EE5D43">-</span><span style="color:#F39C12">0.78</span><span style="color:#D5CED9">)  </span><span style="color:#A0A1A7CC"># 描画位置を指定</span></div><div class="line"><span style="color:#D5CED9">    text </span><span style="color:#EE5D43">=</span><span style="color:#96E072"> "These images are being input to the "</span></div><div class="line"><span style="color:#C74DED">    for</span><span style="color:#D5CED9"> char </span><span style="color:#C74DED">in</span><span style="color:#D5CED9"> text:</span></div><div class="line"><span style="color:#FFE66D">        glutBitmapCharacter</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GLUT_BITMAP_HELVETICA_18</span><span style="color:#D5CED9">, </span><span style="color:#FFE66D">ord</span><span style="color:#D5CED9">(char))  </span><span style="color:#A0A1A7CC"># 文字を描画   </span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glRasterPos2f</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">0.05</span><span style="color:#D5CED9">, </span><span style="color:#EE5D43">-</span><span style="color:#F39C12">0.89</span><span style="color:#D5CED9">)  </span><span style="color:#A0A1A7CC"># 描画位置を指定</span></div><div class="line"><span style="color:#D5CED9">    text </span><span style="color:#EE5D43">=</span><span style="color:#96E072"> "learned model ( ResNet18 )."</span></div><div class="line"><span style="color:#C74DED">    for</span><span style="color:#D5CED9"> char </span><span style="color:#C74DED">in</span><span style="color:#D5CED9"> text:</span></div><div class="line"><span style="color:#FFE66D">        glutBitmapCharacter</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GLUT_BITMAP_HELVETICA_18</span><span style="color:#D5CED9">, </span><span style="color:#FFE66D">ord</span><span style="color:#D5CED9">(char))  </span><span style="color:#A0A1A7CC"># 文字を描画   </span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glFlush</span><span style="color:#D5CED9">()</span></div><div class="line"><span style="color:#FFE66D">    glutSwapBuffers</span><span style="color:#D5CED9">()</span></div><div class="line"><span style="color:#D5CED9"> </span></div><div class="line"><span style="color:#A0A1A7CC">#最初の一回だけサブウィンドウ0に描画</span></div><div class="line"><span style="color:#C74DED">def</span><span style="color:#FFE66D"> draw2</span><span style="color:#D5CED9">():</span></div><div class="line"><span style="color:#FFE66D">    glutSetWindow</span><span style="color:#D5CED9">(subwinnum[</span><span style="color:#F39C12">0</span><span style="color:#D5CED9">])</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glClearColor</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">0.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.0</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#FFE66D">    glClear</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_COLOR_BUFFER_BIT</span><span style="color:#EE5D43"> |</span><span style="color:#F39C12"> GL_DEPTH_BUFFER_BIT</span><span style="color:#D5CED9">)</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glFlush</span><span style="color:#D5CED9">()</span></div><div class="line"><span style="color:#FFE66D">    glutSwapBuffers</span><span style="color:#D5CED9">()</span></div><div class="line">
</div><div class="line"><span style="color:#A0A1A7CC">#最初の一回だけサブウィンドウ1に描画</span></div><div class="line"><span style="color:#C74DED">def</span><span style="color:#FFE66D"> draw3</span><span style="color:#D5CED9">():</span></div><div class="line"><span style="color:#FFE66D">    glutSetWindow</span><span style="color:#D5CED9">(subwinnum[</span><span style="color:#F39C12">1</span><span style="color:#D5CED9">])</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glClearColor</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">0.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.0</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#FFE66D">    glClear</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_COLOR_BUFFER_BIT</span><span style="color:#EE5D43"> |</span><span style="color:#F39C12"> GL_DEPTH_BUFFER_BIT</span><span style="color:#D5CED9">)</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glFlush</span><span style="color:#D5CED9">()</span></div><div class="line"><span style="color:#FFE66D">    glutSwapBuffers</span><span style="color:#D5CED9">()</span></div><div class="line">
</div><div class="line"><span style="color:#A0A1A7CC">#画面キャプチャ</span></div><div class="line"><span style="color:#C74DED">def</span><span style="color:#FFE66D"> capture2</span><span style="color:#D5CED9">():</span></div><div class="line"><span style="color:#D5CED9">    width </span><span style="color:#EE5D43">=</span><span style="color:#FFE66D"> glutGet</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GLUT_WINDOW_WIDTH</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#D5CED9">    height </span><span style="color:#EE5D43">=</span><span style="color:#FFE66D"> glutGet</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GLUT_WINDOW_HEIGHT</span><span style="color:#D5CED9">)</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glReadBuffer</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_FRONT</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#FFE66D">    glPixelStorei</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_UNPACK_ALIGNMENT</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#D5CED9">    data </span><span style="color:#EE5D43">=</span><span style="color:#FFE66D"> glReadPixels</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0</span><span style="color:#D5CED9">, width, height, </span><span style="color:#F39C12">GL_RGB</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">GL_UNSIGNED_BYTE</span><span style="color:#D5CED9">)</span></div><div class="line">
</div><div class="line"><span style="color:#D5CED9">    image </span><span style="color:#EE5D43">=</span><span style="color:#D5CED9"> Image.</span><span style="color:#FFE66D">frombytes</span><span style="color:#D5CED9">(</span><span style="color:#96E072">"RGB"</span><span style="color:#D5CED9">, (width, height), data)</span></div><div class="line"><span style="color:#D5CED9">    image </span><span style="color:#EE5D43">=</span><span style="color:#D5CED9"> ImageOps.</span><span style="color:#FFE66D">flip</span><span style="color:#D5CED9">(image)</span></div><div class="line"><span style="color:#D5CED9">    </span></div><div class="line"><span style="color:#D5CED9">    new_size </span><span style="color:#EE5D43">=</span><span style="color:#D5CED9"> (</span><span style="color:#F39C12">32</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">32</span><span style="color:#D5CED9">) </span><span style="color:#A0A1A7CC"># 縮小するサイズを指定 (幅, 高さ)</span></div><div class="line"><span style="color:#D5CED9">    resized_image </span><span style="color:#EE5D43">=</span><span style="color:#D5CED9"> image.</span><span style="color:#FFE66D">resize</span><span style="color:#D5CED9">(new_size)  </span><span style="color:#A0A1A7CC"># 画像をリサイズ</span></div><div class="line"><span style="color:#A0A1A7CC">    #resized_image.save( "capture2()_test.jpg" )  # 縮小した画像を保存</span></div><div class="line">
</div><div class="line"><span style="color:#C74DED">    return</span><span style="color:#D5CED9"> resized_image</span></div><div class="line">
</div><div class="line"><span style="color:#A0A1A7CC">#ResNet18を使って、衝突するかどうかを判定</span></div><div class="line"><span style="color:#C74DED">def</span><span style="color:#FFE66D"> display_image_recognition</span><span style="color:#D5CED9">():</span></div><div class="line">
</div><div class="line"><span style="color:#A0A1A7CC">    # 画面をキャプチャ</span></div><div class="line"><span style="color:#D5CED9">    field_image </span><span style="color:#EE5D43">=</span><span style="color:#FFE66D"> capture2</span><span style="color:#D5CED9">()</span></div><div class="line">
</div><div class="line"><span style="color:#A0A1A7CC">    # 画像をTensorに変換</span></div><div class="line"><span style="color:#D5CED9">    transform </span><span style="color:#EE5D43">=</span><span style="color:#D5CED9"> transforms.</span><span style="color:#FFE66D">ToTensor</span><span style="color:#D5CED9">()</span></div><div class="line"><span style="color:#D5CED9">    tensor_image </span><span style="color:#EE5D43">=</span><span style="color:#FFE66D"> transform</span><span style="color:#D5CED9">(field_image)</span></div><div class="line"><span style="color:#D5CED9">    input_tensor </span><span style="color:#EE5D43">=</span><span style="color:#D5CED9"> tensor_image.</span><span style="color:#FFE66D">unsqueeze</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">0</span><span style="color:#D5CED9">)  </span><span style="color:#A0A1A7CC"># バッチ次元を追加</span></div><div class="line">
</div><div class="line"><span style="color:#A0A1A7CC">    # 推論</span></div><div class="line"><span style="color:#C74DED">    with</span><span style="color:#D5CED9"> torch.</span><span style="color:#FFE66D">no_grad</span><span style="color:#D5CED9">():</span></div><div class="line"><span style="color:#D5CED9">        Learned_model_output </span><span style="color:#EE5D43">=</span><span style="color:#FFE66D"> Learned_model</span><span style="color:#D5CED9">(input_tensor)</span></div><div class="line">
</div><div class="line"><span style="color:#A0A1A7CC">    #衝突するかどうかを判定</span></div><div class="line"><span style="color:#C74DED">    if</span><span style="color:#D5CED9"> Learned_model_output[</span><span style="color:#F39C12">0</span><span style="color:#D5CED9">,</span><span style="color:#F39C12">0</span><span style="color:#D5CED9">] </span><span style="color:#EE5D43">&#x3C;</span><span style="color:#D5CED9"> Learned_model_output[</span><span style="color:#F39C12">0</span><span style="color:#D5CED9">,</span><span style="color:#F39C12">1</span><span style="color:#D5CED9">]:</span></div><div class="line"><span style="color:#FFE66D">        print</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">1</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#C74DED">        return</span><span style="color:#F39C12"> 1</span></div><div class="line"><span style="color:#C74DED">    else</span><span style="color:#D5CED9">:</span></div><div class="line"><span style="color:#FFE66D">        print</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">0</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#C74DED">        return</span><span style="color:#F39C12"> 0</span></div><div class="line">
</div><div class="line"><span style="color:#A0A1A7CC">#テクスチャ読み込み関数</span></div><div class="line"><span style="color:#C74DED">def</span><span style="color:#FFE66D"> load_texture</span><span style="color:#D5CED9">(</span><span style="color:#00E8C6">texture_file_name</span><span style="color:#D5CED9">):</span></div><div class="line">
</div><div class="line"><span style="color:#A0A1A7CC">    # Generate a texture ID</span></div><div class="line"><span style="color:#D5CED9">    texture_id </span><span style="color:#EE5D43">=</span><span style="color:#FFE66D"> glGenTextures</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">1</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#FFE66D">    glBindTexture</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_TEXTURE_2D</span><span style="color:#D5CED9">, texture_id )</span></div><div class="line">
</div><div class="line"><span style="color:#D5CED9">    img </span><span style="color:#EE5D43">=</span><span style="color:#D5CED9"> Image.</span><span style="color:#FFE66D">open</span><span style="color:#D5CED9">(texture_file_name)</span></div><div class="line"><span style="color:#D5CED9">    w, h </span><span style="color:#EE5D43">=</span><span style="color:#D5CED9"> img.size</span></div><div class="line"><span style="color:#FFE66D">    glTexImage2D</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_TEXTURE_2D</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">GL_RGBA</span><span style="color:#D5CED9">, w, h, </span><span style="color:#F39C12">0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">GL_RGBA</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">GL_UNSIGNED_BYTE</span><span style="color:#D5CED9">, img.</span><span style="color:#FFE66D">tobytes</span><span style="color:#D5CED9">())</span></div><div class="line"><span style="color:#FFE66D">    glTexParameteri</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_TEXTURE_2D</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">GL_TEXTURE_MIN_FILTER</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">GL_LINEAR</span><span style="color:#D5CED9">)    </span><span style="color:#A0A1A7CC"># Set texture parameters</span></div><div class="line"><span style="color:#FFE66D">    glBindTexture</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_TEXTURE_2D</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0</span><span style="color:#D5CED9">)  </span><span style="color:#A0A1A7CC"># Unbind texture</span></div><div class="line">
</div><div class="line"><span style="color:#C74DED">    return</span><span style="color:#D5CED9"> texture_id</span></div><div class="line">
</div><div class="line"><span style="color:#A0A1A7CC">#テクスチャポリゴン</span></div><div class="line"><span style="color:#C74DED">def</span><span style="color:#FFE66D"> draw_tex_polygon</span><span style="color:#D5CED9">():</span></div><div class="line"><span style="color:#A0A1A7CC">    #glClear(GL_COLOR_BUFFER_BIT)#prepare_GL()の中で実行される</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glMaterialfv</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_FRONT</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">GL_AMBIENT</span><span style="color:#D5CED9">, [</span><span style="color:#F39C12">0.5</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.5</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.5</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.5</span><span style="color:#D5CED9">])  </span><span style="color:#A0A1A7CC">#環境光の影響  </span></div><div class="line"><span style="color:#FFE66D">    glMaterialfv</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_FRONT</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">GL_DIFFUSE</span><span style="color:#D5CED9">, [</span><span style="color:#F39C12">0.8</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.8</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.8</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1.0</span><span style="color:#D5CED9">])</span><span style="color:#A0A1A7CC">#地の色の設定</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glBlendFunc</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_SRC_ALPHA</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">GL_ONE_MINUS_SRC_ALPHA</span><span style="color:#D5CED9">)</span><span style="color:#A0A1A7CC">#テクスチャの色と地の色の混ざり方の設定</span></div><div class="line"><span style="color:#FFE66D">    glEnable</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_BLEND</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#FFE66D">    glEnable</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_TEXTURE_2D</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#FFE66D">    glNormal3f</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0</span><span style="color:#D5CED9">)     </span><span style="color:#A0A1A7CC">#glNormal3f()は非推奨の関数らしい</span></div><div class="line">
</div><div class="line"><span style="color:#A0A1A7CC">    #床</span></div><div class="line"><span style="color:#FFE66D">    glBindTexture</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_TEXTURE_2D</span><span style="color:#D5CED9">, tex_floor)</span></div><div class="line"><span style="color:#FFE66D">    glBegin</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_QUADS</span><span style="color:#D5CED9">)</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glTexCoord2d</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.0</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#FFE66D">    glVertex3d</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">, </span><span style="color:#EE5D43">-</span><span style="color:#F39C12">0.01</span><span style="color:#D5CED9">, </span><span style="color:#EE5D43">-</span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">)</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glTexCoord2d</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">0.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.0</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#FFE66D">    glVertex3d</span><span style="color:#D5CED9">( </span><span style="color:#EE5D43">-</span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">, </span><span style="color:#EE5D43">-</span><span style="color:#F39C12">0.01</span><span style="color:#D5CED9">, </span><span style="color:#EE5D43">-</span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">)</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glTexCoord2d</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">0.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#FFE66D">    glVertex3d</span><span style="color:#D5CED9">( </span><span style="color:#EE5D43">-</span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">, </span><span style="color:#EE5D43">-</span><span style="color:#F39C12">0.01</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">)</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glTexCoord2d</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#FFE66D">    glVertex3d</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">, </span><span style="color:#EE5D43">-</span><span style="color:#F39C12">0.01</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">)</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glEnd</span><span style="color:#D5CED9">()</span></div><div class="line">
</div><div class="line"><span style="color:#A0A1A7CC">    #壁　奥</span></div><div class="line"><span style="color:#FFE66D">    glBindTexture</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_TEXTURE_2D</span><span style="color:#D5CED9">, tex_wall)</span></div><div class="line"><span style="color:#FFE66D">    glBegin</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_QUADS</span><span style="color:#D5CED9">)</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glTexCoord2d</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">1.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.0</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#FFE66D">    glVertex3d</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">,  </span><span style="color:#F39C12">0.0</span><span style="color:#D5CED9">, </span><span style="color:#EE5D43">-</span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">)</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glTexCoord2d</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">0.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.0</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#FFE66D">    glVertex3d</span><span style="color:#D5CED9">( </span><span style="color:#EE5D43">-</span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.0</span><span style="color:#D5CED9">, </span><span style="color:#EE5D43">-</span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">)</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glTexCoord2d</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">0.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1.0</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#FFE66D">    glVertex3d</span><span style="color:#D5CED9">( </span><span style="color:#EE5D43">-</span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">2.0</span><span style="color:#D5CED9">, </span><span style="color:#EE5D43">-</span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">)</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glTexCoord2d</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">1.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1.0</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#FFE66D">    glVertex3d</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">,  </span><span style="color:#F39C12">2.0</span><span style="color:#D5CED9">, </span><span style="color:#EE5D43">-</span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">)</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glEnd</span><span style="color:#D5CED9">()</span></div><div class="line">
</div><div class="line"><span style="color:#A0A1A7CC">    #壁　左</span></div><div class="line"><span style="color:#FFE66D">    glBegin</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_QUADS</span><span style="color:#D5CED9">)</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glTexCoord2d</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">1.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.0</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#FFE66D">    glVertex3d</span><span style="color:#D5CED9">(</span><span style="color:#EE5D43">-</span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">)</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glTexCoord2d</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">0.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.0</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#FFE66D">    glVertex3d</span><span style="color:#D5CED9">( </span><span style="color:#EE5D43">-</span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.0</span><span style="color:#D5CED9">, </span><span style="color:#EE5D43">-</span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">)</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glTexCoord2d</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">0.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1.0</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#FFE66D">    glVertex3d</span><span style="color:#D5CED9">( </span><span style="color:#EE5D43">-</span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">2.0</span><span style="color:#D5CED9">, </span><span style="color:#EE5D43">-</span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">)</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glTexCoord2d</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">1.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1.0</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#FFE66D">    glVertex3d</span><span style="color:#D5CED9">(</span><span style="color:#EE5D43">-</span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">,  </span><span style="color:#F39C12">2.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">)</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glEnd</span><span style="color:#D5CED9">()</span></div><div class="line"><span style="color:#96E072">    """</span></div><div class="line"><span style="color:#96E072">    #壁　手前</span></div><div class="line"><span style="color:#96E072">    glBegin(GL_QUADS)</span></div><div class="line">
</div><div class="line"><span style="color:#96E072">    glTexCoord2d(1.0, 0.0)</span></div><div class="line"><span style="color:#96E072">    glVertex3d(4.5,  0.0, 4.5)</span></div><div class="line">
</div><div class="line"><span style="color:#96E072">    glTexCoord2d(0.0, 0.0)</span></div><div class="line"><span style="color:#96E072">    glVertex3d( -4.5, 0.0, 4.5)</span></div><div class="line">
</div><div class="line"><span style="color:#96E072">    glTexCoord2d(0.0, 1.0)</span></div><div class="line"><span style="color:#96E072">    glVertex3d( -4.5, 2.0, 4.5)</span></div><div class="line">
</div><div class="line"><span style="color:#96E072">    glTexCoord2d(1.0, 1.0)</span></div><div class="line"><span style="color:#96E072">    glVertex3d(4.5,  2.0, 4.5)</span></div><div class="line">
</div><div class="line"><span style="color:#96E072">    glEnd()</span></div><div class="line"><span style="color:#96E072">    """</span></div><div class="line"><span style="color:#A0A1A7CC">    #壁　右</span></div><div class="line"><span style="color:#FFE66D">    glBegin</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_QUADS</span><span style="color:#D5CED9">)</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glTexCoord2d</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">1.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.0</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#FFE66D">    glVertex3d</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">)</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glTexCoord2d</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">0.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.0</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#FFE66D">    glVertex3d</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.0</span><span style="color:#D5CED9">, </span><span style="color:#EE5D43">-</span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">)</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glTexCoord2d</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">0.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1.0</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#FFE66D">    glVertex3d</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">2.0</span><span style="color:#D5CED9">, </span><span style="color:#EE5D43">-</span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">)</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glTexCoord2d</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">1.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1.0</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#FFE66D">    glVertex3d</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">2.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">4.5</span><span style="color:#D5CED9">)</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glEnd</span><span style="color:#D5CED9">()</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glDisable</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_TEXTURE_2D</span><span style="color:#D5CED9">)</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glDisable</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_BLEND</span><span style="color:#D5CED9">)</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glFlush</span><span style="color:#D5CED9">()</span><span style="color:#A0A1A7CC">#??#</span></div><div class="line">
</div></code></pre>


<h2>サブウィンドウのサイズ等のコードを変更</h2>
box_robo_vision1.pyのソースコードを下記のように変更します。
変更する場所は、tutorial3.pyの188行目の「<code style="color:rgb(89, 89, 89)">glutCreateWindow ("testode")</code>」関数に対応する部分です。
191行目の「<code style="color:rgb(89, 89, 89)">world = ode.World()</code>」の手前です。

<pre class="andromeeda" style="background-color:#23262E;color:#D5CED9;width:550px;padding:20px"><code><div class="line"><span style="color:#D5CED9">winnum </span><span style="color:#EE5D43">=</span><span style="color:#FFE66D"> glutCreateWindow</span><span style="color:#D5CED9"> (</span><span style="color:#C74DED">b</span><span style="color:#96E072">"testode"</span><span style="color:#D5CED9">)   </span><span style="color:#A0A1A7CC">#bを追加してbyte列にする。#</span></div><div class="line"><span style="color:#FFE66D">glutDisplayFunc</span><span style="color:#D5CED9">(draw1)</span></div><div class="line"><span style="color:#D5CED9">subwinnum </span><span style="color:#EE5D43">=</span><span style="color:#D5CED9"> []</span></div><div class="line"><span style="color:#FFE66D">glutInitWindowSize</span><span style="color:#D5CED9"> ( </span><span style="color:#F39C12">320</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">320</span><span style="color:#D5CED9">);</span></div><div class="line"><span style="color:#D5CED9">subwinnum.</span><span style="color:#FFE66D">append</span><span style="color:#D5CED9">(</span><span style="color:#FFE66D">glutCreateSubWindow</span><span style="color:#D5CED9">(winnum, </span><span style="color:#F39C12">10</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">10</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">320</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">320</span><span style="color:#D5CED9">))</span></div><div class="line"><span style="color:#FFE66D">glutDisplayFunc</span><span style="color:#D5CED9">(draw2)</span></div><div class="line"><span style="color:#FFE66D">glutInitWindowSize</span><span style="color:#D5CED9"> ( </span><span style="color:#F39C12">320</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">320</span><span style="color:#D5CED9">);</span></div><div class="line"><span style="color:#D5CED9">subwinnum.</span><span style="color:#FFE66D">append</span><span style="color:#D5CED9">(</span><span style="color:#FFE66D">glutCreateSubWindow</span><span style="color:#D5CED9">(winnum, </span><span style="color:#F39C12">340</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">10</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">320</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">320</span><span style="color:#D5CED9">))</span></div><div class="line"><span style="color:#FFE66D">glutDisplayFunc</span><span style="color:#D5CED9">(draw3)</span></div></code></pre>

<h2>ResNet18の読み込み等のコードを追加</h2>
box_robo_vision1.pyのソースコードに下記のコードを追加します。
追加する場所は、tutorial3.pyの220行目に対応する行です。223行目の「<code style="color:rgb(89, 89, 89)">def _keyfunc (c, x, y):</code>」の手前です。

<pre class="andromeeda" style="background-color:#23262E;color:#D5CED9;width:600px;padding:20px"><code><div class="line"><span style="color:#A0A1A7CC"># 箱ロボットの行動を決める値</span></div><div class="line"><span style="color:#D5CED9">judge </span><span style="color:#EE5D43">=</span><span style="color:#F39C12"> 0</span></div><div class="line"><span style="color:#D5CED9">judge_pattern </span><span style="color:#EE5D43">=</span><span style="color:#F39C12"> 2</span></div><div class="line"><span style="color:#D5CED9">gaze_x </span><span style="color:#EE5D43">=</span><span style="color:#F39C12"> 0</span></div><div class="line"><span style="color:#D5CED9">gaze_z </span><span style="color:#EE5D43">=</span><span style="color:#EE5D43"> -</span><span style="color:#F39C12">10</span></div><div class="line"><span style="color:#D5CED9">Force_x </span><span style="color:#EE5D43">=</span><span style="color:#F39C12"> 0</span></div><div class="line"><span style="color:#D5CED9">Force_z </span><span style="color:#EE5D43">=</span><span style="color:#EE5D43"> -</span><span style="color:#F39C12">120</span></div><div class="line">
</div><div class="line"><span style="color:#A0A1A7CC">#テクスチャ読み込み#</span></div><div class="line"><span style="color:#FFE66D">glutSetWindow</span><span style="color:#D5CED9">(subwinnum[</span><span style="color:#F39C12">0</span><span style="color:#D5CED9">])</span></div><div class="line"><span style="color:#D5CED9">tex_floor </span><span style="color:#EE5D43">=</span><span style="color:#FFE66D"> load_texture</span><span style="color:#D5CED9">(</span><span style="color:#96E072">"sample1.png"</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#D5CED9">tex_wall </span><span style="color:#EE5D43">=</span><span style="color:#FFE66D"> load_texture</span><span style="color:#D5CED9">(</span><span style="color:#96E072">"sample2.png"</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#FFE66D">glutSetWindow</span><span style="color:#D5CED9">(subwinnum[</span><span style="color:#F39C12">1</span><span style="color:#D5CED9">])</span></div><div class="line"><span style="color:#D5CED9">tex_floor </span><span style="color:#EE5D43">=</span><span style="color:#FFE66D"> load_texture</span><span style="color:#D5CED9">(</span><span style="color:#96E072">"sample1.png"</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#D5CED9">tex_wall </span><span style="color:#EE5D43">=</span><span style="color:#FFE66D"> load_texture</span><span style="color:#D5CED9">(</span><span style="color:#96E072">"sample2.png"</span><span style="color:#D5CED9">)</span></div><div class="line">
</div><div class="line"><span style="color:#A0A1A7CC">#学習していないResNet18 modelを読み込んでインスタンスを生成</span></div><div class="line"><span style="color:#D5CED9">Learned_model </span><span style="color:#EE5D43">=</span><span style="color:#D5CED9"> models.</span><span style="color:#FFE66D">resnet18</span><span style="color:#D5CED9">(</span><span style="color:#00E8C6">weights</span><span style="color:#EE5D43"> =</span><span style="color:#EE5D43"> None</span><span style="color:#D5CED9">)</span></div><div class="line"><span style="color:#A0A1A7CC"># Modify the final fully connected layer for a custom number of classes</span></div><div class="line"><span style="color:#D5CED9">num_classes </span><span style="color:#EE5D43">=</span><span style="color:#F39C12"> 2</span><span style="color:#A0A1A7CC"> #衝突するクラスと衝突しないクラスの2つ</span></div><div class="line"><span style="color:#D5CED9">Learned_model.fc </span><span style="color:#EE5D43">=</span><span style="color:#D5CED9"> nn.</span><span style="color:#FFE66D">Linear</span><span style="color:#D5CED9">(Learned_model.fc.in_features, num_classes)</span></div><div class="line"><span style="color:#A0A1A7CC">#3D空間の画像を使って学習したResNet18の読み込み</span></div><div class="line"><span style="color:#D5CED9">Learned_model.</span><span style="color:#FFE66D">load_state_dict</span><span style="color:#D5CED9">(torch.</span><span style="color:#FFE66D">load</span><span style="color:#D5CED9">(</span><span style="color:#96E072">"Weight1_24.pth"</span><span style="color:#D5CED9">, </span><span style="color:#00E8C6">weights_only</span><span style="color:#EE5D43">=True</span><span style="color:#D5CED9">))</span></div><div class="line"><span style="color:#D5CED9">Learned_model.</span><span style="color:#FFE66D">eval</span><span style="color:#D5CED9">()  </span><span style="color:#A0A1A7CC"># 推論モードに切り替え</span></div></code></pre>

<h2>_drawfunc ()関数を変更</h2>
box_robo_vision1.pyのソースコードを下記のように変更します。
変更する場所は、tutorial3.pyの229行目～237行目の「<code style="color:rgb(89, 89, 89)">def _drawfunc ():</code>」関数に対応する部分です。
240行目の「<code style="color:rgb(89, 89, 89)">def _idlefunc ():</code>」の手前です。237行目（最後の行）のコメントアウトを忘れないようにします。

<pre class="andromeeda" style="background-color:#23262E;color:#D5CED9;width:750px;padding:20px"><code><div class="line"><span style="color:#C74DED">def</span><span style="color:#FFE66D"> _drawfunc0</span><span style="color:#D5CED9"> ():</span></div><div class="line"><span style="color:#C74DED">    global</span><span style="color:#D5CED9"> bodies</span></div><div class="line"><span style="color:#A0A1A7CC">    # Draw the scene</span></div><div class="line"><span style="color:#FFE66D">    prepare_GL</span><span style="color:#D5CED9">()</span></div><div class="line">
</div><div class="line"><span style="color:#A0A1A7CC">    #俯瞰の視点</span></div><div class="line"><span style="color:#FFE66D">    gluLookAt</span><span style="color:#D5CED9"> (</span><span style="color:#F39C12">3.0</span><span style="color:#EE5D43">*</span><span style="color:#F39C12">2.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">3.6</span><span style="color:#EE5D43">*</span><span style="color:#F39C12">2.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">5.0</span><span style="color:#EE5D43">*</span><span style="color:#F39C12">1.5</span><span style="color:#D5CED9">, </span><span style="color:#EE5D43">-</span><span style="color:#F39C12">1.0</span><span style="color:#D5CED9">, </span><span style="color:#EE5D43">-</span><span style="color:#F39C12">1.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0</span><span style="color:#D5CED9">)</span><span style="color:#A0A1A7CC">#（視点位置、注視点位置、姿勢方向）</span></div><div class="line">
</div><div class="line"><span style="color:#C74DED">    for</span><span style="color:#D5CED9"> index, b </span><span style="color:#C74DED">in</span><span style="color:#FFE66D"> enumerate</span><span style="color:#D5CED9">(bodies):</span></div><div class="line"><span style="color:#C74DED">        if</span><span style="color:#D5CED9"> index </span><span style="color:#EE5D43">==</span><span style="color:#F39C12"> 0</span><span style="color:#D5CED9">:</span></div><div class="line"><span style="color:#FFE66D">            glMaterialfv</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_FRONT</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">GL_AMBIENT</span><span style="color:#D5CED9">, [</span><span style="color:#F39C12">0.5</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.5</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.5</span><span style="color:#D5CED9">])  </span><span style="color:#A0A1A7CC">#環境光の影響  </span></div><div class="line"><span style="color:#FFE66D">            glMaterialfv</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_FRONT</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">GL_DIFFUSE</span><span style="color:#D5CED9">, [</span><span style="color:#F39C12">0.5</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.5</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.1</span><span style="color:#D5CED9">])</span></div><div class="line"><span style="color:#C74DED">        if</span><span style="color:#D5CED9"> index </span><span style="color:#EE5D43">==</span><span style="color:#F39C12"> 1</span><span style="color:#D5CED9">:                 </span></div><div class="line"><span style="color:#FFE66D">            glMaterialfv</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_FRONT</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">GL_AMBIENT</span><span style="color:#D5CED9">, [</span><span style="color:#F39C12">0.3</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.3</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1.0</span><span style="color:#D5CED9">])  </span><span style="color:#A0A1A7CC">#環境光の影響  </span></div><div class="line"><span style="color:#FFE66D">            glMaterialfv</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_FRONT</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">GL_DIFFUSE</span><span style="color:#D5CED9">, [</span><span style="color:#F39C12">0.3</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.3</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1.0</span><span style="color:#D5CED9">])</span></div><div class="line"><span style="color:#FFE66D">        draw_body</span><span style="color:#D5CED9">(b)</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    draw_tex_polygon</span><span style="color:#D5CED9">()</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glutSwapBuffers</span><span style="color:#D5CED9"> ()</span></div><div class="line">
</div><div class="line"><span style="color:#C74DED">def</span><span style="color:#FFE66D"> _drawfunc1</span><span style="color:#D5CED9"> ():</span></div><div class="line"><span style="color:#C74DED">    global</span><span style="color:#D5CED9"> bodies, objcount, gaze_x, gaze_z</span></div><div class="line"><span style="color:#A0A1A7CC">    # Draw the scene</span></div><div class="line"><span style="color:#FFE66D">    prepare_GL</span><span style="color:#D5CED9">()</span></div><div class="line"><span style="color:#D5CED9">    </span></div><div class="line"><span style="color:#D5CED9">    x,y,z </span><span style="color:#EE5D43">=</span><span style="color:#F39C12"> 0</span><span style="color:#D5CED9">,</span><span style="color:#F39C12">0</span><span style="color:#D5CED9">,</span><span style="color:#F39C12">0</span></div><div class="line"><span style="color:#C74DED">    if</span><span style="color:#D5CED9"> objcount </span><span style="color:#EE5D43">>=</span><span style="color:#F39C12"> 1</span><span style="color:#D5CED9">:</span></div><div class="line"><span style="color:#D5CED9">        x,y,z </span><span style="color:#EE5D43">=</span><span style="color:#D5CED9"> bodies[</span><span style="color:#F39C12">0</span><span style="color:#D5CED9">].</span><span style="color:#FFE66D">getPosition</span><span style="color:#D5CED9">()</span></div><div class="line"><span style="color:#A0A1A7CC">    #箱ロボットの視点</span></div><div class="line"><span style="color:#FFE66D">    gluLookAt</span><span style="color:#D5CED9"> ( x, y, z, x </span><span style="color:#EE5D43">+</span><span style="color:#D5CED9"> gaze_x, </span><span style="color:#F39C12">0.2</span><span style="color:#D5CED9">, z </span><span style="color:#EE5D43">+</span><span style="color:#D5CED9"> gaze_z, </span><span style="color:#F39C12">0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0</span><span style="color:#D5CED9">)</span><span style="color:#A0A1A7CC">#（視点位置、注視点位置、姿勢方向）</span></div><div class="line">
</div><div class="line">
</div><div class="line"><span style="color:#C74DED">    for</span><span style="color:#D5CED9"> index, b </span><span style="color:#C74DED">in</span><span style="color:#FFE66D"> enumerate</span><span style="color:#D5CED9">(bodies):</span></div><div class="line"><span style="color:#C74DED">        if</span><span style="color:#D5CED9"> index </span><span style="color:#EE5D43">==</span><span style="color:#F39C12"> 1</span><span style="color:#D5CED9">:                 </span></div><div class="line"><span style="color:#FFE66D">            glMaterialfv</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_FRONT</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">GL_AMBIENT</span><span style="color:#D5CED9">, [</span><span style="color:#F39C12">0.3</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.3</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1.0</span><span style="color:#D5CED9">])  </span><span style="color:#A0A1A7CC">#環境光の影響  </span></div><div class="line"><span style="color:#FFE66D">            glMaterialfv</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">GL_FRONT</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">GL_DIFFUSE</span><span style="color:#D5CED9">, [</span><span style="color:#F39C12">0.3</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.3</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1.0</span><span style="color:#D5CED9">])</span></div><div class="line">
</div><div class="line"><span style="color:#C74DED">        if</span><span style="color:#D5CED9"> index </span><span style="color:#EE5D43">>=</span><span style="color:#F39C12"> 1</span><span style="color:#D5CED9">:           </span></div><div class="line"><span style="color:#FFE66D">            draw_body</span><span style="color:#D5CED9">(b)</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    draw_tex_polygon</span><span style="color:#D5CED9">()</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glutSwapBuffers</span><span style="color:#D5CED9"> ()</span></div><div class="line">
</div><div class="line"><span style="color:#A0A1A7CC">#glutDisplayFunc (_drawfunc)</span></div></code></pre>

<h2>_idlefunc ()関数を変更</h2>
box_robo_vision1.pyのソースコードを下記のように変更します。
変更する場所は、tutorial3.pyの240行目～279行目の「<code style="color:rgb(89, 89, 89)">def _idlefunc ():</code>」関数に対応する部分です。
281行目の「<code style="color:rgb(89, 89, 89)">glutIdleFunc (_idlefunc)</code>」の手前です。

<pre class="andromeeda" style="background-color:#23262E;color:#D5CED9;width:600px;padding:20px"><code><div class="line"><span style="color:#C74DED">def</span><span style="color:#FFE66D"> _idlefunc</span><span style="color:#D5CED9"> ():</span></div><div class="line"><span style="color:#C74DED">    global</span><span style="color:#D5CED9"> counter, lasttime</span></div><div class="line"><span style="color:#C74DED">    global</span><span style="color:#D5CED9"> judge, judge_pattern, gaze_x, gaze_z, Force_x, Force_z</span></div><div class="line"><span style="color:#C74DED">    global</span><span style="color:#D5CED9"> bodies, geoms, subwinnum, world,contactgroup</span></div><div class="line">
</div><div class="line"><span style="color:#D5CED9">    t </span><span style="color:#EE5D43">=</span><span style="color:#D5CED9"> dt </span><span style="color:#EE5D43">-</span><span style="color:#D5CED9"> (time.</span><span style="color:#FFE66D">time</span><span style="color:#D5CED9">() </span><span style="color:#EE5D43">-</span><span style="color:#D5CED9"> lasttime)</span></div><div class="line"><span style="color:#C74DED">    if</span><span style="color:#D5CED9"> (t </span><span style="color:#EE5D43">></span><span style="color:#F39C12"> 0</span><span style="color:#D5CED9">):</span></div><div class="line"><span style="color:#D5CED9">        time.</span><span style="color:#FFE66D">sleep</span><span style="color:#D5CED9">(t)</span></div><div class="line">
</div><div class="line"><span style="color:#D5CED9">    counter </span><span style="color:#EE5D43">+=</span><span style="color:#F39C12"> 1</span></div><div class="line"><span style="color:#C74DED">    if</span><span style="color:#D5CED9"> counter</span><span style="color:#EE5D43">==</span><span style="color:#F39C12">30</span><span style="color:#D5CED9">:       </span></div><div class="line"><span style="color:#FFE66D">        drop_object</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">0.3</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.3</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.3</span><span style="color:#D5CED9">,</span></div><div class="line"><span style="color:#F39C12">                     0.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">3.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.0</span><span style="color:#D5CED9">)  </span><span style="color:#A0A1A7CC">#(lx, ly, lz, px, py, pz)</span></div><div class="line"><span style="color:#D5CED9">        </span></div><div class="line"><span style="color:#96E072">        """       </span></div><div class="line"><span style="color:#96E072">        drop_object(0.3, 1.0, 6.0,</span></div><div class="line"><span style="color:#96E072">                     2.0, 3.0, 1.49)  #(lx, ly, lz, px, py, pz)       </span></div><div class="line"><span style="color:#96E072">        drop_object(0.3, 1.0, 6.0,</span></div><div class="line"><span style="color:#96E072">                     -2.0, 3.0, -1.49)  #(lx, ly, lz, px, py, pz)   </span></div><div class="line"><span style="color:#96E072">        """</span><span style="color:#D5CED9">        </span></div><div class="line"><span style="color:#D5CED9">        </span></div><div class="line"><span style="color:#FFE66D">        drop_object</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">2.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.3</span><span style="color:#D5CED9">,</span></div><div class="line"><span style="color:#F39C12">                     0.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">3.0</span><span style="color:#D5CED9">, </span><span style="color:#EE5D43">-</span><span style="color:#F39C12">2.0</span><span style="color:#D5CED9">)  </span><span style="color:#A0A1A7CC">#(lx, ly, lz, px, py, pz)             </span></div><div class="line"><span style="color:#FFE66D">        drop_object</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">0.3</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">2.0</span><span style="color:#D5CED9">,</span></div><div class="line"><span style="color:#F39C12">                     1.2</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">3.0</span><span style="color:#D5CED9">, </span><span style="color:#EE5D43">-</span><span style="color:#F39C12">1.15</span><span style="color:#D5CED9">)  </span><span style="color:#A0A1A7CC">#(lx, ly, lz, px, py, pz)                </span></div><div class="line"><span style="color:#FFE66D">        drop_object</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">0.3</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">2.0</span><span style="color:#D5CED9">,</span></div><div class="line"><span style="color:#EE5D43">                     -</span><span style="color:#F39C12">1.2</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">3.0</span><span style="color:#D5CED9">, </span><span style="color:#EE5D43">-</span><span style="color:#F39C12">1.15</span><span style="color:#D5CED9">)  </span><span style="color:#A0A1A7CC">#(lx, ly, lz, px, py, pz) </span></div><div class="line"><span style="color:#D5CED9">        </span></div><div class="line"><span style="color:#FFE66D">        drop_object</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">2.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">0.3</span><span style="color:#D5CED9">,</span></div><div class="line"><span style="color:#F39C12">                     0.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">3.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">2.5</span><span style="color:#D5CED9">)  </span><span style="color:#A0A1A7CC">#(lx, ly, lz, px, py, pz)  </span></div><div class="line"><span style="color:#FFE66D">        drop_object</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">0.3</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">2.0</span><span style="color:#D5CED9">,</span></div><div class="line"><span style="color:#F39C12">                     2.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">3.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1.55</span><span style="color:#D5CED9">)  </span><span style="color:#A0A1A7CC">#(lx, ly, lz, px, py, pz)  </span></div><div class="line"><span style="color:#FFE66D">        drop_object</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">0.3</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">2.0</span><span style="color:#D5CED9">,</span></div><div class="line"><span style="color:#EE5D43">                     -</span><span style="color:#F39C12">2.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">3.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1.55</span><span style="color:#D5CED9">)  </span><span style="color:#A0A1A7CC">#(lx, ly, lz, px, py, pz)  </span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">        drop_object</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">0.3</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1.0</span><span style="color:#D5CED9">,</span></div><div class="line"><span style="color:#F39C12">                     0.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">3.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">4.0</span><span style="color:#D5CED9">)  </span><span style="color:#A0A1A7CC">#(lx, ly, lz, px, py, pz)     </span></div><div class="line"><span style="color:#FFE66D">        drop_object</span><span style="color:#D5CED9">(</span><span style="color:#F39C12">0.3</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1.0</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">1.0</span><span style="color:#D5CED9">,</span></div><div class="line"><span style="color:#F39C12">                     1.2</span><span style="color:#D5CED9">, </span><span style="color:#F39C12">3.0</span><span style="color:#D5CED9">, </span><span style="color:#EE5D43">-</span><span style="color:#F39C12">4.0</span><span style="color:#D5CED9">)  </span><span style="color:#A0A1A7CC">#(lx, ly, lz, px, py, pz)             </span></div><div class="line">
</div><div class="line">
</div><div class="line"><span style="color:#C74DED">    if</span><span style="color:#D5CED9"> counter</span><span style="color:#EE5D43">==</span><span style="color:#F39C12">200</span><span style="color:#D5CED9">:     </span></div><div class="line"><span style="color:#D5CED9">        judge </span><span style="color:#EE5D43">=</span><span style="color:#FFE66D"> display_image_recognition</span><span style="color:#D5CED9">()</span></div><div class="line"><span style="color:#C74DED">        if</span><span style="color:#D5CED9"> judge </span><span style="color:#EE5D43">==</span><span style="color:#F39C12"> 0</span><span style="color:#D5CED9">:</span></div><div class="line"><span style="color:#D5CED9">            bodies[</span><span style="color:#F39C12">0</span><span style="color:#D5CED9">].</span><span style="color:#FFE66D">addForce</span><span style="color:#D5CED9">(( Force_x, </span><span style="color:#F39C12">0</span><span style="color:#D5CED9">, Force_z))</span></div><div class="line">
</div><div class="line"><span style="color:#C74DED">        if</span><span style="color:#D5CED9"> judge </span><span style="color:#EE5D43">==</span><span style="color:#F39C12"> 1</span><span style="color:#D5CED9">:</span></div><div class="line"><span style="color:#D5CED9">            judge_pattern </span><span style="color:#EE5D43">+=</span><span style="color:#F39C12"> 1</span></div><div class="line"><span style="color:#A0A1A7CC">            #judge_pattern = random.randint(1, 4)</span></div><div class="line">
</div><div class="line"><span style="color:#C74DED">            if</span><span style="color:#D5CED9"> judge_pattern</span><span style="color:#EE5D43">==</span><span style="color:#F39C12"> 1</span><span style="color:#D5CED9">:</span></div><div class="line"><span style="color:#D5CED9">                Force_x </span><span style="color:#EE5D43">=</span><span style="color:#F39C12"> 120</span></div><div class="line"><span style="color:#D5CED9">                gaze_x </span><span style="color:#EE5D43">=</span><span style="color:#F39C12"> 10</span></div><div class="line"><span style="color:#D5CED9">                Force_z </span><span style="color:#EE5D43">=</span><span style="color:#F39C12"> 0</span></div><div class="line"><span style="color:#D5CED9">                gaze_z </span><span style="color:#EE5D43">=</span><span style="color:#F39C12"> 0</span></div><div class="line"><span style="color:#C74DED">            if</span><span style="color:#D5CED9"> judge_pattern</span><span style="color:#EE5D43">==</span><span style="color:#F39C12"> 2</span><span style="color:#D5CED9">:</span></div><div class="line"><span style="color:#D5CED9">                Force_x </span><span style="color:#EE5D43">=</span><span style="color:#F39C12"> 0</span></div><div class="line"><span style="color:#D5CED9">                gaze_x </span><span style="color:#EE5D43">=</span><span style="color:#F39C12"> 0</span></div><div class="line"><span style="color:#D5CED9">                Force_z </span><span style="color:#EE5D43">=</span><span style="color:#EE5D43"> -</span><span style="color:#F39C12">120</span></div><div class="line"><span style="color:#D5CED9">                gaze_z </span><span style="color:#EE5D43">=</span><span style="color:#EE5D43"> -</span><span style="color:#F39C12">10</span></div><div class="line"><span style="color:#C74DED">            if</span><span style="color:#D5CED9"> judge_pattern</span><span style="color:#EE5D43">==</span><span style="color:#F39C12"> 3</span><span style="color:#D5CED9">:</span></div><div class="line"><span style="color:#D5CED9">                Force_x </span><span style="color:#EE5D43">=</span><span style="color:#EE5D43"> -</span><span style="color:#F39C12">120</span></div><div class="line"><span style="color:#D5CED9">                gaze_x </span><span style="color:#EE5D43">=</span><span style="color:#EE5D43"> -</span><span style="color:#F39C12">10</span></div><div class="line"><span style="color:#D5CED9">                Force_z </span><span style="color:#EE5D43">=</span><span style="color:#F39C12"> 0</span></div><div class="line"><span style="color:#D5CED9">                gaze_z </span><span style="color:#EE5D43">=</span><span style="color:#F39C12"> 0</span><span style="color:#D5CED9">                </span></div><div class="line"><span style="color:#C74DED">            if</span><span style="color:#D5CED9"> judge_pattern</span><span style="color:#EE5D43">==</span><span style="color:#F39C12"> 4</span><span style="color:#D5CED9">:</span></div><div class="line"><span style="color:#D5CED9">                Force_x </span><span style="color:#EE5D43">=</span><span style="color:#F39C12"> 0</span></div><div class="line"><span style="color:#D5CED9">                gaze_x </span><span style="color:#EE5D43">=</span><span style="color:#F39C12"> 0</span></div><div class="line"><span style="color:#D5CED9">                Force_z </span><span style="color:#EE5D43">=</span><span style="color:#F39C12"> 120</span></div><div class="line"><span style="color:#D5CED9">                gaze_z </span><span style="color:#EE5D43">=</span><span style="color:#F39C12"> 10</span></div><div class="line">
</div><div class="line"><span style="color:#C74DED">            if</span><span style="color:#D5CED9"> judge_pattern </span><span style="color:#EE5D43">==</span><span style="color:#F39C12"> 4</span><span style="color:#D5CED9">:</span></div><div class="line"><span style="color:#D5CED9">                judge_pattern </span><span style="color:#EE5D43">=</span><span style="color:#F39C12"> 0</span></div><div class="line">
</div><div class="line"><span style="color:#A0A1A7CC">        #カウンターをオブジェクト作成後に戻す</span></div><div class="line"><span style="color:#D5CED9">        counter </span><span style="color:#EE5D43">=</span><span style="color:#F39C12"> 160</span></div><div class="line"><span style="color:#D5CED9">  </span></div><div class="line"><span style="color:#A0A1A7CC">    #異なる視点の画像を2つの画面に描画する</span></div><div class="line"><span style="color:#FFE66D">    glutSetWindow</span><span style="color:#D5CED9">(subwinnum[</span><span style="color:#F39C12">0</span><span style="color:#D5CED9">])</span></div><div class="line"><span style="color:#FFE66D">    glutDisplayFunc</span><span style="color:#D5CED9"> (_drawfunc0)</span></div><div class="line"><span style="color:#FFE66D">    glutPostRedisplay</span><span style="color:#D5CED9"> ()</span></div><div class="line">
</div><div class="line"><span style="color:#FFE66D">    glutSetWindow</span><span style="color:#D5CED9">(subwinnum[</span><span style="color:#F39C12">1</span><span style="color:#D5CED9">])</span></div><div class="line"><span style="color:#FFE66D">    glutDisplayFunc</span><span style="color:#D5CED9"> (_drawfunc1)</span></div><div class="line"><span style="color:#FFE66D">    glutPostRedisplay</span><span style="color:#D5CED9"> ()</span></div><div class="line">
</div><div class="line">
</div><div class="line"><span style="color:#A0A1A7CC">     ##衝突検出部分を書き換え。#############</span></div><div class="line"><span style="color:#A0A1A7CC">    # Simulate</span></div><div class="line"><span style="color:#D5CED9">    n </span><span style="color:#EE5D43">=</span><span style="color:#F39C12"> 4</span></div><div class="line"><span style="color:#C74DED">    for</span><span style="color:#D5CED9"> i </span><span style="color:#C74DED">in</span><span style="color:#FFE66D"> range</span><span style="color:#D5CED9">(n):</span></div><div class="line"><span style="color:#C74DED">        for</span><span style="color:#D5CED9"> g1 </span><span style="color:#C74DED">in</span><span style="color:#D5CED9"> geoms:    </span></div><div class="line"><span style="color:#C74DED">            for</span><span style="color:#D5CED9"> g2 </span><span style="color:#C74DED">in</span><span style="color:#D5CED9"> geoms:</span></div><div class="line"><span style="color:#D5CED9">    </span></div><div class="line"><span style="color:#FFE66D">                near_callback</span><span style="color:#D5CED9">((world,contactgroup), g1, g2)</span></div><div class="line">
</div><div class="line"><span style="color:#C74DED">        for</span><span style="color:#D5CED9"> g1 </span><span style="color:#C74DED">in</span><span style="color:#D5CED9"> geoms:</span></div><div class="line"><span style="color:#FFE66D">            near_callback</span><span style="color:#D5CED9">((world,contactgroup), g1, floor)</span></div><div class="line">
</div><div class="line"><span style="color:#A0A1A7CC">        #space.collide((world,contactgroup), ode.collide_callback(g1, floor))</span></div><div class="line"><span style="color:#A0A1A7CC">         # Simulation step</span></div><div class="line"><span style="color:#D5CED9">        world.</span><span style="color:#FFE66D">step</span><span style="color:#D5CED9">(dt</span><span style="color:#EE5D43">/</span><span style="color:#D5CED9">n)</span></div><div class="line"><span style="color:#A0A1A7CC">        # Remove all contact joints</span></div><div class="line"><span style="color:#D5CED9">        contactgroup.</span><span style="color:#FFE66D">empty</span><span style="color:#D5CED9">()</span></div><div class="line">
</div><div class="line"><span style="color:#A0A1A7CC">     ##衝突検出部分を書き換え。終了。#############</span></div><div class="line">
</div><div class="line"><span style="color:#D5CED9">    lasttime </span><span style="color:#EE5D43">=</span><span style="color:#D5CED9"> time.</span><span style="color:#FFE66D">time</span><span style="color:#D5CED9">()</span></div></code></pre>
</pre>
    </div> 

    <!--フッタ-->
    <div id="footer"><small>hiramatsuyuusuke</small></div>

</div>
</body>
</html>